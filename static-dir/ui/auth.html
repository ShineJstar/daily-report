<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DailyReport</title>
    <style type="text/css">
    body{
        font-size: 12px;
    }
    </style>
</head>
<body>
    <div id="login"></div>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="conf.js"></script>
    <script type="text/javascript">
    function require_login(){
        // 应用的APPID
        var appID = get_qq_oauth_app_id();
        // 成功授权后的回调地址
        var redirectURI = get_qq_oauth_redirect_url();
        // 透传的状态
        var state = "dev";
        
        var path = 'https://graph.qq.com/oauth2.0/authorize?';
        var queryParams = ['client_id=' + appID,
            'redirect_uri=' + redirectURI,
            'scope=' + 'get_user_info', 
            'response_type=token',
            'state=' + state];

        var query = queryParams.join('&');
        var url = path + query;
        //console.log(url);
        $("#login").html("<a href='" + url + "'><img src='login.png'/></a>");
        //window.location.href = url;
    }
    
    $(function(){
        // 没有access_token，要求登录
        if (window.location.hash.length == 0){
            require_login();
            return;
        }
    
        // 获取了access_token，获取用户信息
        var access_token = window.location.hash.substring(1);
        document.cookie = "access_token="+access_token;
        window.location.href = "submit.html";
    });
    </script>
</body>
